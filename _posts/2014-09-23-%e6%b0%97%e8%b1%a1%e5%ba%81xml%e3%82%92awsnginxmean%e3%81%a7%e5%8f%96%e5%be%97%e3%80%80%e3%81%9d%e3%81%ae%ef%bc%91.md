---
title: 気象庁XMLをAWS+Nginx+MEANで取得　その１
author: kenev
layout: post
permalink: /2014/09/23/%e6%b0%97%e8%b1%a1%e5%ba%81xml%e3%82%92awsnginxmean%e3%81%a7%e5%8f%96%e5%be%97%e3%80%80%e3%81%9d%e3%81%ae%ef%bc%91/
categories:
  - OpenData
tags:
  - AngularJS
  - AWS
  - EC2
  - Express
  - MongoDB
  - NodeJS
  - 気象庁XML
---
<a href="http://tokyometro10th.jp/future/opendata/" target="_blank">東京メトロ</a>がオープンデータのコンテスト(2014/11/17迄)を開催中ですが、最近オープンデータという言葉をちょっとだけ多めに聞くようになったような気がします。

今回は気象庁が公開している<a href="http://xml.kishou.go.jp/" target="_blank">気象庁防災情報XML</a>の入手に挑戦してみようと思います。まず、単純にアクセストークンをくっつけてGETできるプロトコルではなく、PubSubHubbub（パブサブハバブ）というプロトコルが使われています。初めて聞く人はこの呪文みたいな名前は何？って思うかもしれませんがPublisher(発行者), Subscriber(購読者), Hub(仲介人)の略だと覚えておけば意外とすぐ名前自体は覚えれるプロトコルです。

主な流れ的には以下のような感じです。

[<img class="alignnone  wp-image-154" src="/images/2014/09/PubSubHubbub-300x191.png" alt="PubSubHubbub" width="493" height="314" />][1]

噛み砕いて言ってしまえば皆が皆気象庁にアクセスして「電文ちょうだい！」ってなるとPublisherである気象庁がパンクしちゃうのでHubが仲介してくれて、かつフィードには電文のヘッダ情報が含まれてるので気象庁的には「必要に応じて取りに来てね」というスタンスでOKになるのです。

ここらへんの仕組みは気象庁サイトの「<a href="http://xml.kishou.go.jp/open_trial/guidance.html" target="_blank">電文公開の仕組み</a>」のコーナーでそれなりに詳しく書いてあるので一読することをお勧めします。

さて、上の内容は結構他のサイトと冗長な内容になるのでここらへんにします。今回この気象庁XMLを取得する為にバックエンドはAWS(Amazon Web Services)のEC2(Elastic Cloud Compute)でLinux Serverを立ち上げてNginXでリバースプロキシを設置し、NodeJS+Expressでリクエストを受けてMongoDBにデータを格納していきたいと思います。フロントエンドに関してはAngularJSを使わせていただきます。流行（？）のMEAN環境の構築ですね。  
図示すると下のような感じ。

[<img class="alignnone  wp-image-157" src="/images/2014/09/Env-300x147.png" alt="Env" width="543" height="266" />][2]

まずはAWSでEC2のインスタンスを作成（AMIはUbuntuを使用）してsshで接続できるようにします。ここにさっそくNodeJS+Expressの環境を構築していきます。NodeJSを直接ポート80で公開したくないので、NginxをインストールしてリバースプロキシでNodeJSに向けるようにします。今回データ格納にはMongoDBを使いますのでMongoDBもインストールしておきます。ここらへんのHowToはGoogle先生に聞いたらすぐにいろんな記事が出てくるので各自がんばってください。

ここまでで環境構築自体は完了です。次回以降で実際にNodeJSでSubscriber用のAPIを作っていきます

 [1]: /images/2014/09/PubSubHubbub.png
 [2]: /images/2014/09/Env.png
