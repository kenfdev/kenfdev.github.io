---
title: 'これだけは覚えておこうES2015(旧ES6)【let, const】'
author: kenev
layout: post
permalink: /2016/04/15/es2015-es6-let-const/
s4_url2s:
  -
s4_image2s:
  -
s4_ctitle:
  -
s4_cdes:
  -
categories:
  - es2015
  - es6
tags:
  - es2015
  - es6
  - let
  - const
---


これからの標準となっていくES2015(ES6)！ただ、増える文法や機能がありすぎてげんなりしちゃう！という人もたくさんいると思いますので、私が **これだけは覚えておいた方がいい！** と思う文法や機能を独断と偏見でまとめてちょっとずつ解説していきたいと思うシリーズです。

# let, const

第一弾として登場するのが `let` と `const` です。これが何かというと、ES5までは変数を宣言するときに `var` しか存在しませんでした。この `var`、意外と仕様を知らない人が多いため、思わぬ罠にはまることがあります。

# 結論

`var` で宣言した変数はホイスト（巻き上げられる）されるし、 `function` 単位でのスコープしか存在しない。( `if` や `for` などの **ブロック内** で宣言してもブロック内のスコープというものは **存在しない** 。

それに対して、 `let` や `const` はホイストされず、宣言された場所で初期化されるし、 `if` や `for` のブロック内で宣言したものは ブロック内でしか存在しない **ブロックスコープ** が適用される。

# 解説

## ホイストされない

ホイストは変数の宣言が巻き上げられることです。文字で言われてもぱっとしないと思うので、コードで書くと↓

{% highlight js %}

'use strict';

console.log(a);

var a = 10;

{% endhighlight %}

ここで `console` で何が出力されるかわかる人はホイストがわかっている人です。
答えは

`undefined`

`var` はホイストされるので↓と書いてあるのと同じ意味なんです。

{% highlight js %}
'use strict';
var a;

console.log(a);

a = 10;
{% endhighlight %}

なので `undefined` になります。

`let` と `const` はホイストされないので、同じような↓のコードでも結果が変わります。

{% highlight js %}
'use strict';

console.log(a);

let a = 10; // constでも同じ

// 結果
// ReferenceError: a is not defined
{% endhighlight %}

ホイストされないが故に `console.log` のときには `a` が存在しないので `ReferenceError` になります。


### letとconstの違い

↑の違いはわかったとして、 `let` と `const` の違いはどうなるのでしょう？？？これは他の言語などやったことある人ならわかると思いますが、 `const` は **定数** です。なので、一度値を定めたらその値を変更することができません。仮に変更しようとすると↓のように怒られます。

{% highlight js %}
'use strict';

const a = 10;

a = 11;

// 結果
// a = 11;
//   ^
// TypeError: Assignment to constant variable.
{% endhighlight %}

## ブロックスコープ

`let` と `const` の登場によって、ブロックスコープが使えるようになりました。他言語から来た人が勘違いしやすかったところです。まず、ES5までは

{% highlight js %}
'use strict';

var a = 10;

if(true) {
    var a = 20;
}

console.log(a);
{% endhighlight %}

と書いた場合に `console` に出力されるのはなんと

`20`

です。 **ブロックスコープ** に慣れている人からすると違和感ありあり（ `10` じゃないの？）ですが、 `var` には **ブロックスコープ** が無いので、 `if` の中の `a` も、外の `a` も同じスコープに存在しています。よって、 `if` の外の `a` を上書いてしまうのです。

特に間違えやすいのが↓の結果です。

{% highlight js %}
'use strict'

for(var i = 0; i < 2; i++) {
    setTimeout(function() { console.log(i) }, 2000);
}

{% endhighlight %}

普通に考えたら `0`、`1`が出力されそうですよね？でも違うんです。結果は

`2`、`2` と、 `2` が2回表示されます。

何故かと言うと、 `for` のブロックスコープが存在しないからです。ホイストもされるので↑のコードは↓と書いているのと一緒です。

{% highlight js %}
'use strict'

var i;
for(i = 0; i < 2; i++) {
    setTimeout(function() { console.log(i) }, 2000);
}
{% endhighlight %}

なので、2秒後に出力するころには `i` の値は `2` になっているんです。
これが `let` `const` になると **ブロックスコープ** が適用されるので、直感的な動きをしてくれるようになります。

{% highlight js %}
'use strict';

let a = 10;

if(true) {
    let a = 20;
}

console.log(a);
// 結果：10
{% endhighlight %}

`for` にも **ブロックスコープ** が適用されます。

{% highlight js %}
'use strict'

for(let i = 0; i < 2; i++) {
    setTimeout(function() { console.log(i) }, 2000);
}

// 結果
// 0
// 1
{% endhighlight %}

# まとめ
`let` と `const` いろいろとだらだら書きましたが、ようするに直感的に変数宣言できるようになった！って覚えてもらったら十分な気がします（笑）人によっては `let` と `const` なんか必要ない！ `var` だけで十分だ！って言う人もいますが、私は個人的に `let` と `const` が好きです。将来的にはブラウザの最適化の恩恵とかも受けれそうですしね。[次回](https://blog.suzukishouten.co.jp/archives/575)はアロー関数（=>）について解説します！

# おまけ
ちなみに `Babel` などのトランスパイラを使った場合に↑のES2015 `for` 文はES5では↓になります。

{% highlight js %}
'use strict';

// 関数をクッションにすることで独自のスコープを
// 生成できるので、iの値が保持される仕組み
var _loop = function _loop(i) {
    setTimeout(function () {
          console.log(i);
            }, 2000);
};

for (var i = 0; i < 2; i++) {
    _loop(i);
}
{% endhighlight %}
