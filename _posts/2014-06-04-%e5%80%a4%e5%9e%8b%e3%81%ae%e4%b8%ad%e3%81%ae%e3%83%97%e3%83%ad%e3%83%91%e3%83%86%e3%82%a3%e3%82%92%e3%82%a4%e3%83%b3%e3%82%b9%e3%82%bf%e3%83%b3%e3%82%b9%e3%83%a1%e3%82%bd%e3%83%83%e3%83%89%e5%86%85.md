---
title: 値型の中のプロパティをインスタンスメソッド内でいじる
author: kenev
layout: post
permalink: /2014/06/04/%e5%80%a4%e5%9e%8b%e3%81%ae%e4%b8%ad%e3%81%ae%e3%83%97%e3%83%ad%e3%83%91%e3%83%86%e3%82%a3%e3%82%92%e3%82%a4%e3%83%b3%e3%82%b9%e3%82%bf%e3%83%b3%e3%82%b9%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e5%86%85/
categories:
  - Swift
tags:
  - class
  - enum
  - mutating
  - mutating-func
  - struct
  - Swift
  - value-type
---
structとenumは値型なので、通常は値型のプロパティを自身のインスタンスメソッド内で変更することはできません。

まずは参照型であるclassでプロパティの変更を行ってみます。（通常こんなクラス作らないけど）

<pre class="lang:default highlight:0 decode:true">class PointClass {
    var x = 0.0, y = 0.0
    init(x: Double, y: Double) {
        self.x = x
        self.y = y
    }
    // classは参照型なので自身のインスタンスメソッド内でプロパティを変更できる
    func moveByX(deltaX: Double, y deltaY: Double) {
        x += deltaX
        y += deltaY
    }
}

var classPoint = PointClass(x: 1.0, y: 1.0)
classPoint.moveByX(2.0, y: 3.0)
println("The class point is now at (\(classPoint.x), \(classPoint.y))")
// 出力結果
// The class point is now at (3.0, 4.0)</pre>

見たまんまです。普通にメソッドを定義してそのメソッド内でプロパティを変更しています。  
これがstructの場合どうするかと言いますと、funcの前にmutatingというキーワードをつけるのです。

<pre class="lang:default highlight:0 decode:true">struct PointStruct {
    var x = 0.0, y = 0.0
    // structは値型なので通常は自身のインスタンスメソッド内でプロパティの変更はできない。
    // が！mutatingをつけることで可能に！
    mutating func moveByX(deltaX: Double, y deltaY: Double) {
        x += deltaX
        y += deltaY
    }
}
var structPoint = PointStruct(x: 1.0, y: 1.0)
structPoint.moveByX(2.0, y: 3.0)
println("The struct point is now at (\(structPoint.x), \(structPoint.y))")
// 出力結果
// The struct point is now at (3.0, 4.0)</pre>

こうすることで値型であるstructのプロパティを自身のインスタンスメソッド内で変更可能に！ちなみにmutatingをつけない場合どうなるかというと、コンパイラに怒られます。

<pre class="lang:default highlight:0 decode:true">Playground execution failed: error: &lt;REPL&gt;:26:11: error: could not find an overload for '+=' that accepts the supplied arguments
x += deltaX
~~^~~~~~~~~
&lt;REPL&gt;:27:11: error: could not find an overload for '+=' that accepts the supplied arguments
y += deltaY</pre>

Enumの場合は下のように書くことで自身の値を変更可能です。

<pre class="lang:default decode:true">enum Mode : String {
    case X = "X mode"
    case Y = "Y mode"
    // struct同様「mutating」をつけることで自身を変更可能
    mutating func switchMode() {
        self = self == X ? Y : X
    }
}
var mode = Mode.X
println("The mode is now \(mode.toRaw()).")
// 出力結果：The mode is now X mode.
mode.switchMode()
println("The mode is now \(mode.toRaw()).")
// 出力結果：The mode is now Y mode.</pre>

Enumもmutatingをつけない場合はコンパイラに怒られます。

<pre class="lang:default highlight:0 decode:true">Playground execution failed: error: &lt;REPL&gt;:42:14: error: cannot assign to 'self' in a method
        self = self == X ? Y : X
        ~~~~ ^
</pre>

&nbsp;