---
title: '[MarionetteJS→React 001] 静的コンテンツの表示'
author: kenev
layout: post
permalink: /2015/07/30/marionettejs%e2%86%92react-001-%e9%9d%99%e7%9a%84%e3%82%b3%e3%83%b3%e3%83%86%e3%83%b3%e3%83%84%e3%81%ae%e8%a1%a8%e7%a4%ba/
s4_url2s:
  - 
s4_image2s:
  - 
s4_ctitle:
  - 
s4_cdes:
  - 
categories:
  - JavaScript
  - Marionette
  - React.js
  - TypeScript
  - Web-dev
tags:
  - itemview
  - layoutview
  - marionette
  - react
---
# はじめに

本業ではMarionetteJSを使っていて、[Backbone.Marionette.js: A Gentle Introduction][1]という本と出会ったのですが、いい感じにMarionetteJSでSPAを作る方法をまとめている良書です。

だけどMarionetteJSを使ってみるとやっぱりコードを追いかけるのが大変すぎる。。。イベント地獄でどこで何が起きているのか常に把握し続けるのは至難の業。（特に自分が作っていないコードなど）これはでもMarionetteJSの特性上仕方ないのかなー、と思いつつ、やっぱり最近の流行のReactを知っておきたいってのが組み合わさって、MarionetteJSの理解も深めつつ、それをReactで書くとどうなるのかっていうのを二兎追うものはなんとやら的なスタンスで検証していきたいと思います。  
参考にするのは上の著書でも使われている[リポジトリ][2]です。これをReactで書いてみます。  
React側については現時点でmasterブランチでしか手に入らない1.6系のTypeScriptでTSX書いて行きたいと思います。

# 準備

`gulp`やらなにやらって話はここではしません。割りとソースとか設計思想にだけ注目したいので、いきなり実装の方に進みます。もちろん、指摘や質問がある場合はコメント欄等で書いてもらえるうれしいです。  
とりあえずは自分で作った[minimal-tsx-starter][3]リポジトリからテンプレをとってきて

<pre><code class="bash">npm install
tsd reinstall --save --overwrite
gulp browserify
</code></pre>

実行して動作確認。

# 静的コンテンツの表示

## MarionetteJS

まずはMarionetteJSによる静的コンテンツの表示です。  
以下、ソース抜粋。

<pre class="lang:html decode:true">&lt;div id="app-container"&gt;
      &lt;div id="main-region" class="container"&gt;
        &lt;p&gt;Here is static content in the web page. You'll notice that it gets replaced by our app as soon as we start it.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;script type="text/template" id="static-template"&gt;
      &lt;p&gt;This is text that was rendered by our Marionette app.&lt;/p&gt;
    &lt;/script&gt;

    &lt;script src="./assets/js/vendor/jquery.js"&gt;&lt;/script&gt;
    &lt;script src="./assets/js/vendor/json2.js"&gt;&lt;/script&gt;
    &lt;script src="./assets/js/vendor/underscore.js"&gt;&lt;/script&gt;
    &lt;script src="./assets/js/vendor/backbone.js"&gt;&lt;/script&gt;
    &lt;script src="./assets/js/vendor/backbone.marionette.js"&gt;&lt;/script&gt;

    &lt;script type="text/javascript"&gt;
      var ContactManager = new Marionette.Application();

      ContactManager.StaticView = Marionette.ItemView.extend({
        template: "#static-template"
      });

      ContactManager.on("before:start", function(){
        var RegionContainer = Marionette.LayoutView.extend({
          el: "#app-container",

          regions: {
            main: "#main-region"
          }
        });

        ContactManager.regions = new RegionContainer();
      });

      ContactManager.on("start", function(){
        var staticView = new ContactManager.StaticView();
        ContactManager.regions.main.show(staticView);
      });

      ContactManager.start();
    &lt;/script&gt;
</pre>

&nbsp;

MarionetteJSは定番のパターンですが、まずレイアウトを決めるLayoutViewで、使用する領域(region)を定義して、その中に子ViewとしてItemViewを入れています。MarionetteJSのコーディングスタイルは基本的にこんな感じになるかと思います。  
[<img src="/images/2015/07/cbfe56a5dfa18b2fb87269d4df50ef88.png" alt="marionette→react_001" width="410" height="403" class="alignnone size-full wp-image-414" />][4]

## React

似たようなページをReactで書いてみます。個人的にTSXをいっぱい書きたかったので、ReactはTypeScriptで書くことにしています。

<pre class="lang:js decode:true ">/// &lt;reference path="../typings/tsd.d.ts" /&gt;

import * as React from "react";

class ContactManager extends React.Component {
  render () {
    return &lt;p&gt;
    This is text that was rendered by our React app.
    &lt;/p&gt;
  }
}

let element = React.createElement(ContactManager);
React.render(element, document.querySelector('#main-region'));
</pre>

&nbsp;

なんの変哲もないコードですが、Reactはコンポーネントを作って仮想DOMを作成していくコーディングスタイルです。TypeScript1.6からJSXがサポートされるようになるので、TypeScriptでReactが書けるようになったのです！  
上のコードは`ContactManager`というコンポーネントを`#main-region`に`render`してねーっていう単純な内容です。  
DOMもしっかり仮想DOMから変換されてます。

<pre class="lang:default decode:true ">&lt;div id="app-container&gt;
  &lt;div id="main-region" class="container"&gt;&lt;p data-reactid=".0"&gt;This is text that was rendered by our React app.&lt;/p&gt;&lt;/div&gt;
&lt;/div&gt;
</pre>

特に述べることはありませんが、２つとも意図通りには動いています。

 [1]: https://leanpub.com/marionette-gentle-introduction
 [2]: https://github.com/davidsulc/marionette-gentle-introduction
 [3]: https://github.com/kenfdev/minimal-tsx-starter
 [4]: /images/2015/07/cbfe56a5dfa18b2fb87269d4df50ef88.png
