---
title: railsのmodelに複合一意制約
author: kenev
layout: post
permalink: /2014/01/17/rails%e3%81%aemodel%e3%81%ab%e8%a4%87%e5%90%88%e4%b8%80%e6%84%8f%e5%88%b6%e7%b4%84/
categories:
  - Rails
---
&nbsp;

<pre class="lang:ruby decode:true">validates_uniqueness_of :first_name_kanji, :scope =&gt; [:first_name_kana, :last_name_kanji, :last_name_kana]</pre>

姓名の漢字とカナで複合一意制約をかけたい場合は上記のようにModelにvalidates\_uniqueness\_ofを定義してあげればOK。

<pre class="lang:mysql decode:true">Parameters: {"utf8"=&gt;"✓", "authenticity_token"=&gt;"1SM4/SAaw0pW9efYL5AJA/AOPyRAScXr1SktWEAuIFs=", "character"=&gt;{"last_name_kanji"=&gt;"犀川", "last_name_kana"=&gt;"さいかわ", "first_name_kanji"=&gt;"創平", "first_name_kana"=&gt;"そうへい", "birth_year"=&gt;"1961"}, "commit"=&gt;"Create character"}
(0.1ms) begin transaction
Character Exists (0.2ms) SELECT 1 AS one FROM "characters" WHERE ("characters"."first_name_kanji" = '創平' AND "characters"."first_name_kana" = 'そうへい' AND "characters"."last_name_kanji" = '犀川' AND "characters"."last_name_kana" = 'さいかわ') LIMIT 1

(0.1ms) rollback transaction</pre>

こんな制約のかけ方することなんて（同姓同名に一意制約がかかるので）無いと思いますが 一応これで上のように同姓同名を登録しようとした時に失敗してrollbackが走ります。  
後はDB側にも定義しておけばばっちし。